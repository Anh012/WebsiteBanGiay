using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Web.Http;
using WEB_API_03_12_23.Models;

namespace WEB_API_03_12_23.Controllers
{
    public class SanPhamController : ApiController
    {
        QLSanPhamEntities db = new QLSanPhamEntities();
        [HttpGet]
        public List<SanPham> GetAllData()
        {
            return db.SanPhams.ToList();
        }
        [HttpPost]
        public bool Them(int ma,string ten,string donvi,int soluong,int gia)
        {
            SanPham sp = db.SanPhams.SingleOrDefault(x => x.MaSP == ma);
            if (sp == null)
            {
                SanPham spNew = new SanPham();
                spNew.MaSP = ma;
                spNew.TenSP = ten;
                spNew.DVTinh = donvi;
                spNew.SoLuong = soluong;
                spNew.Gia = gia;
                db.SanPhams.Add(spNew);
                db.SaveChanges();
                return true;
            }
            return false;
        }
        [HttpDelete]
        public bool Xoa(int id)
        {
            SanPham sp = db.SanPhams.FirstOrDefault(x => x.MaSP == id);
            if (sp != null)
            {
                db.SanPhams.Remove(sp);
                db.SaveChanges();
                return true;
            }
            return false;
        }
    }
}
-
-
------------
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Net;
using System.IO;
using System.Runtime.Serialization.Json;

namespace WINDOWS_FORM_03_12_23
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        // hàm này để khi run chương trình thì hiển thị luôn dữ liệu
        private void Form1_Load(object sender, EventArgs e) 
        {
            display();
        }
        // hàm load data từ API lên View
        private void display()
        {
            string link = "http://localhost/hello/api/sanphams";
            HttpWebRequest request = WebRequest.CreateHttp(link);
            WebResponse response = request.GetResponse();
            DataContractJsonSerializer js = new DataContractJsonSerializer(typeof(SanPham[]));
            object data = js.ReadObject(response.GetResponseStream());
            SanPham[] ds = data as SanPham[];
            dataGridView1.DataSource = ds;
            foreach(DataGridViewColumn column in dataGridView1.Columns)
            {
                column.AutoSizeMode = DataGridViewAutoSizeColumnMode.Fill;
            }
            dataGridView1.Columns[0].HeaderText = "Mã sản phẩm";
            dataGridView1.Columns[1].HeaderText = "Tên sản phẩm";
            dataGridView1.Columns[2].HeaderText = "Đơn vị tính";
            dataGridView1.Columns[3].HeaderText = "Số lượng";
            dataGridView1.Columns[4].HeaderText = "Giá";
        }
        // hàm xử lý sự kiện thêm sản phẩm 
        private void btnThem_Click(object sender, EventArgs e)
        {
            string postString = string.Format("?ma={0}&ten={1}&donvi={2}&soluong={3}&gia={4}",
                txtMaSP.Text, txtTenSP.Text, txtDVTinh.Text, txtSoLuong.Text, txtGia.Text);
            string link = "http://localhost/hello/api/sanphams" + postString;
            HttpWebRequest request = HttpWebRequest.CreateHttp(link);
            request.Method = "POST";
            request.ContentType = "application/json;charset=UTF-8";
            byte[] byteArr = Encoding.UTF8.GetBytes(postString);
            request.ContentLength = byteArr.Length;
            Stream dataStream = request.GetRequestStream();
            dataStream.Write(byteArr, 0, byteArr.Length);
            dataStream.Close();
            DataContractJsonSerializer js = new DataContractJsonSerializer(typeof(bool));
            object data = js.ReadObject(request.GetResponse().GetResponseStream());
            bool kt = (bool)data;
            if (kt)
            {
                MessageBox.Show("Thêm thông tin sản phẩm thành công !", "Thông báo");
                clear();
                display();
            }
            else
            {
                MessageBox.Show("Thêm thông tin sản phẩm thất bại !", "Thông báo");
                clear();
            }
        }
        // hàm xử lý sự kiện xóa sản phẩm 
        private void btnXoa_Click(object sender, EventArgs e)
        {
            DialogResult result = MessageBox.Show("Bạn có chắc chắn muốn xóa?", "???", MessageBoxButtons.YesNo);
            if (result == DialogResult.Yes)
            {
                string deleteString = string.Format("?id={0}",
                txtMaSP.Text);
                string link = "http://localhost/hello/api/sanphams" + deleteString;
                HttpWebRequest request = HttpWebRequest.CreateHttp(link);
                request.Method = "DELETE";
                request.ContentType = "application/json;charset=UTF-8";
                byte[] byteArr = Encoding.UTF8.GetBytes(deleteString);
                request.ContentLength = byteArr.Length;
                Stream dataStream = request.GetRequestStream();
                dataStream.Write(byteArr, 0, byteArr.Length);
                dataStream.Close();
                DataContractJsonSerializer js = new DataContractJsonSerializer(typeof(bool));
                object data = js.ReadObject(request.GetResponse().GetResponseStream());
                bool kt = (bool)data;
                if (kt)
                {
                    MessageBox.Show("Xóa thông tin sản phẩm thành công !", "Thông báo");
                    clear();
                    display();
                }
                else
                {
                    MessageBox.Show("Xóa thông tin sản phẩm thất bại !", "Thông báo");
                    clear();
                }
            }
            
        }
        // hàm clear các textbox
        private void clear()
        {
            txtMaSP.Clear();
            txtTenSP.Clear();
            txtDVTinh.Clear();
            txtSoLuong.Clear();
            txtGia.Clear();
            ActiveControl = txtMaSP;
        }
        // hàm khi click vào 1 hàng thì hiển thị thông tin lên các text box
        private void PushData(object sender, DataGridViewCellEventArgs e)
        {
            SanPham sp = (SanPham)dataGridView1.CurrentRow.DataBoundItem;
            if (sp != null)
            {
                txtMaSP.Text = sp.MaSP.ToString();
                txtTenSP.Text = sp.TenSP.ToString();
                txtDVTinh.Text = sp.DVTinh;
                txtSoLuong.Text = sp.SoLuong.ToString();
                txtGia.Text = sp.Gia.ToString();
            }
        }
        // hàm reload
        private void btnReload_Click(object sender, EventArgs e)
        {
            display();
        }
    }
}

